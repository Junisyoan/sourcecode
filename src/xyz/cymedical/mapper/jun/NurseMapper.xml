<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN" 
"http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">

<mapper namespace="xyz.cymedical.mapper.jun.NurseMapper">

<!-- 创建体检人和套餐关系表 -->
	<insert id="insertPaitentCombo">
		insert into tb_patient_combo(patient_id,combo_id,biller_id) 
		values
		<foreach collection="pList" item="p" separator=",">
			(#{p.paitent_id},#{p.combo_id},#{bid})
		</foreach>
	</insert>
<!-- 根据记账表查询导检单 -->
	<!-- 病人实体类查询 -->
	<select id="getCheckPage" parameterType="String" resultType="xyz.cymedical.entity.jun.Patient">
	select p.name,p.sex,p.age,p.check_num,c.name cname,pr.name pname,par.name prname,d.name dname
	from tb_patient_combo pac
	LEFT JOIN tb_patient p ON pac.patient_id=p.patient_id and pac.biller_id = #{bid}
	LEFT JOIN tb_combo c ON c.combo_id=pac.combo_id
	LEFT JOIN tb_project_combo pc ON pc.combo_id=c.combo_id
	LEFT JOIN tb_project pr ON pr.project_id=pc.project_id
	LEFT JOIN tb_param par on par.param_id = pr.param_id
	LEFT JOIN tb_detail_project dp ON dp.project_id=pr.project_id
	LEFT JOIN tb_detail d on dp.detail_id=d.detail_id
	ORDER BY name asc,pname asc;
	</select>
<!-- 批量插入 -->
	<insert id="insertBatchRelation">
		insert into tb_biller_patient(biller_id,patient_id)
		values
		<foreach collection="pList" item="p" separator=",">
			(#{bid},#{p.paitent_id})
		</foreach>
	</insert>

<!-- 套餐信息 -->
	<select id="queryComboByName" parameterType="String" resultType="xyz.cymedical.entity.xin.Combo">
		select * from tb_combo where name = #{comboName}
	</select>

<!-- 查询待审核文件列表 -->
	<select id="queryCheckFile" parameterType="int" resultType="xyz.cymedical.entity.jun.CompanyFile">
		select f.*,c.name from tb_file f join tb_company c on f.company_id = c.company_id and f.cstate='未审核' limit #{pageNum},10
	</select>
	
<!-- 登录查询 -->
	<select id="queryNurseByLogin" parameterType="String" resultType="xyz.cymedical.entity.jun.Nurse">
		select * from tb_user where account = #{account} and pwd = #{pwd}
	</select>
</mapper>